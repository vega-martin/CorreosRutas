{% extends "base.html" %}

{% block content %}

    <h1>Visualizador de puntos de parada</h1>

    <div class="formulario">
        <h2>Subir ficheros CSV</h2>

        <div class="file-section">
            <form method="POST" action="{{ url_for('fileUpload.upload_file', file_type='A') }}" enctype="multipart/form-data">
                <label>Fichero A:</label>
                <input type="file" name="fileA" accept=".csv" required>
                <input type="submit" value="Subir Fichero A">
            </form>
        </div>

        <div class="file-section">
            <form method="POST" action="{{ url_for('fileUpload.upload_file', file_type='B') }}" enctype="multipart/form-data">
                <label>Fichero B:</label>
                <input type="file" name="fileB" accept=".csv" required>
                <input type="submit" value="Subir Fichero B">
            </form>
        </div>

        <div class="file-section">
            <form method="POST" action="{{ url_for('fileUpload.upload_file', file_type='C') }}" enctype="multipart/form-data">
                <label>Fichero C:</label>
                <input type="file" name="fileC" accept=".csv" required>
                <input type="submit" value="Subir Fichero C">
            </form>
        </div>
    </div>

    {% if session.get('uploaded_files') %}
    <div class="uploaded-files">
        <h2>📂 Ficheros cargados en sesión</h2>
        <ul>
            {% for key, path in session['uploaded_files'].items() %}
                <li><strong>{{ key }}:</strong> {{ path.split('/')[-1] }}</li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}

    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <ul>
          {% for category, message in messages %}
            <li style="color: {{ 'red' if category == 'error' else 'green' }}">{{ message }}</li>
          {% endfor %}
        </ul>
      {% endif %}
    {% endwith %}

    <h2>Acciones</h2>
    <form action="{{ url_for('generateResults.generar_mapa') }}" method="get">
        <button type="submit" class="generate-btn">Generar tablas y mapas</button>
    </form>
<!--
    <form action="{{ url_for('generateResults.detectar_paradas') }}" method="get">
        <button type="submit">Detectar Paradas</button>
    </form>

    <form action="{{ url_for('generateResults.generar_paradas') }}" method="get">
        <button type="submit">Generar Paradas</button>
    </form>

    <form action="{{ url_for('generateResults.grafica_vel_tiempo') }}" method="get">
        <button type="submit">Gráfica Vel/Tiempo</button>
    </form>
-->
    <h2>Sesión</h2>
    <form action="{{ url_for('main.logout') }}" method="get" onsubmit="return confirmLogout();">
        <button type="submit" class="logout-btn">Cerrar sesión / Limpiar sesión</button>
    </form>

    <script>
    function confirmLogout() {
        return confirm("¿Seguro que deseas cerrar la sesión y eliminar los ficheros subidos?");
    }
    </script>
    
<!--
    <div class="mapa">
        <h2>Mapa generado</h2>
        <iframe id="mapaRenderizado" src="" width="100%" height="500px" style="border:1px solid #ccc;"></iframe>
        <br>
        <a id="descagarMapa" href="#" target="_blank">Descargar Mapa</a>
    </div>
-->
{% endblock %}