{% extends "base.html" %}

{% block content %}

    <h1>Visualizador de puntos de parada</h1>

    <div class="formulario">
        <h2>Subir ficheros CSV</h2>

        <div class="file-section">
            <form method="POST" action="{{ url_for('fileUpload.uploadFileToBackend') }}" enctype="multipart/form-data">
                <label for="fileA">Fichero A:</label>
                <input type="file" name="fileA" accept=".csv" required><br><br>
                <label for="fileB">Fichero B:</label>
                <input type="file" name="fileB" accept=".csv" required><br><br>
                <label for="fileC">Fichero C:</label>
                <input type="file" name="fileC" accept=".csv" required><br><br>
                <input type="submit" value="Subir Ficheros">
            </form>
        </div>
    </div>

    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
        <ul>
            {% for category, message in messages %}
            <li style="color: {{ 'red' if category == 'error' else 'green' }}">{{ message }}</li>
            {% endfor %}
        </ul>
        {% endif %}
    {% endwith %}

    {% if session.get('uploaded_files') %}
    <div class="uploaded-files">
        <h2> Ficheros cargados en sesi贸n</h2>
        <ul>
            {% for key, path in session['uploaded_files'].items() %}
                <li><strong>{{ key }}:</strong> {{ path.replace('\\', '/').split('/')[-1] }}</li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}


    <h2>Acciones</h2>
    <form action="{{ url_for('generateResults.generar_mapa') }}" method="get">
        <button type="submit" class="generate-btn">Generar tabla y mapa (Fichero A)</button>
    </form><br>
    <form action="{{ url_for('generateResults.unifyFiles') }}" method="get">
        <button type="submit" class="generate-btn">Mandar a unificar ficheros</button>
    </form>


    <h2>Sesi贸n</h2>
    <form action="{{ url_for('main.logout') }}" method="get" onsubmit="return confirmLogout();">
        <button type="submit" class="logout-btn">Cerrar sesi贸n / Limpiar sesi贸n</button>
    </form>

    <script>
    function confirmLogout() {
        return confirm("驴Seguro que deseas cerrar la sesi贸n y eliminar los ficheros subidos?");
    }
    </script>
{% endblock %}